\section{Essais Préliminaires}

Avant de chercher à comparer différentes techniques d'auralisation, une étude des moyens de comparaison et divers
essais préliminaires sont menés.

% TODO
%
% - comparaison entre RI recoupés et RI standard
% - nécessité du calage temporel
% - moyens de comparaison fréquentielle

\subsection{Fenêtrage temporel des réponses impulsionnelles} % {{{1

\begin{figure}[h!]
\centering{\includegraphics[width=15cm]{ri_non_recoupee.png}}
\caption{\label{ri_non_recoupee}Une des RI mesurées avant le fenêtrage (ici, le canal gauche d'une RI binaurale en salle
Mersenne). La figure a) montre la RI avant fenêtrage et la figure b) la même RI après fenêtrage}.
\end{figure}

Lors de la prise de réponses impulsionnelles, afin de ne pas dégrader l'information en «coupant» les réflexions les plus
tardives, les mesures sont faites sur des temps assez longs (voir figure~\ref{ri_non_recoupee});

De telles mesures posent plusieurs soucis, d'abord en terme de stockage mais aussi en terme de temps de calcul.

Les mesures de RI sont donc fenêtrées pour éliminer les blancs avant et après du traitement. Afin de conserver les
fichiers originaux et d'éviter l'apparition d'incohérences dans les fichiers de mesures, les fenêtrages sont codés en
dur dans les scripts de traitement et les fichiers de mesures sont laissés tels quels.

Il semble intéressant enfin de regarder quelle influence a le fenêtrage d'une RI sur le processus d'auralisation.

\begin{figure}[h!]
\centering{\includegraphics[width=15cm]{spks_ri_recoupe_superimposed.png}}
\caption{\label{spectres_recoupage}Les spectres des sons resultant de la convolution avec une RI fenêtrée (en rouge) et
non fenêtrée (en bleu). Même si les écarts sont faibles, ils existent.}
\end{figure}

Après deux tests, il apparaît que le fenêtrage des RI apporte un gain non négligeable en terme de temps de
calculs\footnote{une partie des calculs étant faits sur une machine peu puissante, cette composante est importante}.
Toutefois, comme le montre la figure~\ref{spectres_recoupage}, on remarque que les spectres de signaux convolués avec
une RI fenêtrée d'une part et non fenêtrés de l'autre ne sont pas identiques. Il faut malgré tout préciser que
perceptivement l'utilisation d'une RI fenêtrée rend le son plus net et moins bruité (plus réaliste en fait). Cela vient
probablement de l'élimination par fenêtrage du bruit de fond avant et après le son utile.

\subsection{Réduction du temps de calcul : procédé de convolution} % {{{1

La convolution est une opération mathématique très gourmande en temps processeur et en mémoire. Même si elle peut être
assez facilement parallèlisée\footnote{Soit avec des processeurs mathématiques dédiés soit avec des processeurs
hautement parallèles type GPU (processeurs de carte graphique)}, ces deux solutions étaient hors de portée ici.

La convolution joue dans le projet un rôle central puisqu'elle est l'outil permettant de passer d'une RI et d'un son
anéchoïque à un résultat sonore représentant la façon dont l'espace lié à la RI aurait modifié le son (voir
figure~\ref{lien_convo_projet}).

\begin{figure}[h!]
\centering{\includegraphics[width=9cm]{lien_convo_projet.png}}
\caption{\label{lien_convo_projet}Lien entre le projet et la convolution. En haut, la convolution «physique» (lorsque
qu'un signal $s(t)$ est émis dans la salle (de réponse impulsionnelle $H(t)$. Au milieu la convolution mathématique au
sens strict (\textit{via} l'opération consacrée). En bas, la convolution mathématique en utilisant la propriété de
symétrie entre convolution temporelle et multiplication fréquentielle. La chaine du bas est plus longue mais les calculs
sont plus rapides que pour celle du milieu.}
\end{figure}

La tranformée de Fourier (TF) est une opération qui n'est pas strictement réversible et qui entraine une légère perte de
données :

$$TF^{-1}\left\{TF\left\{s(t)\right\}\right\} \approx s(t)$$

La fonction \texttt{conv()} proposée par \matlab et GNU/Octave réalise une convolution mathématique stricte (au sens
discret). Celle ci est toutefois très lente sur des machines peu puissantes.

La fonction \texttt{fftconv()} proposée par GNU/Octave est par contre nettement plus rapide, elle utilise le mécanisme
présenté en bas de la figure~\ref{lien_convo_projet}. Cette fonction n'est toutefois pas proposée nativement dans
\matlab. Elle est réimplémentée pour le projet en s'appuyant sur un script trouvé sur le site utilisateurs du
logiciel\footnote{\url{http://www.mathworks.com/matlabcentral/fileexchange/5703-fftconv/content/fftconv.m}} :

\begin{Verbatim}[samepage=true]
function c = fftconv(a,b);

na = length(a);
nb = length(b);

n=na+nb;

A = fft(a,n);
B = fft(b,n);

c = ifft(A.*B,n);
c = real(c(1:na+nb-1));
\end{Verbatim}

Il semble intéressant de s'intéresser (au moins un peu) à l'erreur induite par l'utilisation de \texttt{fftconv()}
plutot que \texttt{conv}. La même convolution est réalisée avec chacune des fonctions, puis une simple distance
géométrique est utilisée pour calculer la distance existant entre les deux signaux : 

$$ d(t) = \sqrt{\left|\left[s_1(t)\right]^2 - \left[s_2(t)\right]^2\right|}$$

où $d(t)$ est la distance entre les signaux $s_1$ et $s_2$ au point d'abscisse $t$.

\begin{figure}[h!]
\centering{\includegraphics[width=12cm]{comp_conv_fftconv.png}}
\caption{\label{comp_conv_fftconv}Comparaison entre les résultats d'une même convolution avec \texttt{conv()} d'une part
et \texttt{fftconv()} d'autre part. On remarque notamment que sur le graphe du bas (représentant la distance géométrique
entre les 2 graphes au dessus), l'axe des ordonnées est gradué entre $2\cdot10^{-7}$ et $2\cdot10^{-6}$.}
\end{figure}

Le graphe obtenu est présenté en figure~\ref{comp_conv_fftconv}, il faut notamment noter que l'axe des ordonnées sur
le graphe des distances est gradué entre $2\cdot10^{-7}$ et $2\cdot10^{-6}$.

Devant la faible amplitude de l'erreur provoquée par l'utilisation de \texttt{fftconv()} et le gain en temps de calcul
réalisé, cette fonction semble largement plus avantageuse que \texttt{conv()}.

\subsection{Utlisation d'un ballon de baudruche} % {{{1

La réponse impulsionnelle d'une salle doit caractériser une salle et particulièrement les différentes réflexion induites
par sa géométrie.

Afin d'avoir une mesure la plus fidèle possible à la réalité du terrain, il faut que la source utilisée pour générer
l'impulsion (ou le bruit permettant la prise d'une réponse en fréquences) soit la plus omni-directionnelle possible.

L'utilisation d'un ballon de baudruche posait le souci que sa directivité est inconnue. Avec plus de temps, un
caractérisation de la directivité du ballon aurait pu être intéressante.

Une telle étude semble être en cours ou avoir été réalisée au LIMSI~\cite{Bru10}, malheureusement l'étude n'est pas
disponible à la consultation : pour ce projet, le ballon de baudruche sera donc considéré omnidirectionnel.

Le second incovénient soulevé par l'utilisation d'un ballon de baudruche est que la bande passante du son généré par
son éclatement n'est pas connu. Un éclatement de ballon de baudruche est donc mesuré en salle semi-anéchoïque (le
spectre est visible en figure~\ref{spk_ballon_anecho}.

\begin{figure}[h!]
\centering{\includegraphics[width=15cm]{rep_ballon_anecho.png}}
\caption{\label{spk_ballon_anecho}}Enregistrement temporel de l'éclatement d'un ballon de baudruche en salle
semi-anéchoïque (noter la réflexions visible en temporel) et spectre du signal.}
\end{figure}

La réponse en fréquences n'est donc clairement pas plate. On note une décroissance de -20dB par décade et une série de
minima en hautes fréquences ainsi qu'un creux dans la bande 10 - 200Hz.

Une tentative de compensation des imperfections de la chaine d'excitation est décrite dans la suite.
